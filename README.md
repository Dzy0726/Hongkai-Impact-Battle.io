# HongKai Impact Battle(崩坏大作战)

## 1. 项目背景

该项目为同济大学软件学院2019年C++程序设计课程设计项目，选题为弓箭手大作战。

选题要求：

1. 得分权值：1.1
2. 团队人数限制：<=4
3. 实现一个类似于arrow.io或弓箭手大作战的游戏。需要达成的基础功能：
   - 支持鼠标和键盘操作
   - 支持道具拾取功能
   - 支持动画
   - 支持多种不同类型的武器
   - 实现服务端：支持联机对战、电脑AI加入、多人在同一个地图上游戏



## 2. 开发环境

- 操作系统：macOS High Sierra
- IDE：Xcode 10.2
- 开发语言：C++
- 测试环境：macOS High Sierra



## 3.如何运行

Mac用户可以直接下载`.app`文件，双击运行，等待片刻，防止重复打开多个游戏

其余平台暂未开发



## 4. 项目文件

|               文件（夹）                |            说明            |
| :-------------------------------------: | :------------------------: |
|                 Classes                 |      游戏主要的类代码      |
| Resources/A monster、monster2、monster3 |  电脑AI图片及骨骼动作资源  |
|           Resources/MUSICres            |          背景音乐          |
|             Resources/UIres             |         游戏UI资源         |
|             Resources/fonts             |          字体资源          |
|         Resources/hero1、hero2          | 玩家角色图片及骨骼动作资源 |
|             Resources/item              |      道具、子弹等资源      |
|            Resources/mapres             |        地图素材资源        |
|                 cocos2d                 |        cocos2d依赖         |
|                   pic                   |        说明文件图片        |



## 5. 核心功能及实现

### 5.1 ⿏标和键盘操作

1. 简单的侦听器，⽤map容器存储⽅向键对应的布尔值
2. 创建侦听器，在键盘按下和放回的时候改变对应按键的布尔值。在update⾥扫描map容器各个按键的布尔值，调⽤对应方向的移动函数
3. update⾥记录当前方向与上一次扫描的方向，如果当前⽅向不同于上⼀次的⽅向，改变运⾏的动画数组，从⽽解决移动动画的卡顿问题，当所有键对应的布尔值都为0时，调⽤之前⽅向对应的站⽴动画，并将之前方向设为0，使站⽴动画避免重复调用⽽抽搐

### 5.2 道具的创建和拾取

1. 创建10个道具精灵类的组合，包括两个属性——**种类**和**是否存在**的布尔类型
2. 创建时候扫描10个精灵的是否存在值布尔值。若有0的出现变使该精灵变为新精灵，保证了了地图上最多有10个道具的出现
3. 创建的时候随机生成⼀个坐标作为道具的位置（需要进⾏碰撞检测避免道具出⽣在墙壁内），之后随机生成一个0到10的值。根据random的区间确定刷新的种类并记录为道具的属性，从而可以实现道具的概率刷新
4. Update⾥面随时调用hero与道具坐标的碰撞检测，结果为1时根据道具的属性值对主角的属性做出改变

### 5.3 电脑AI

1. 地图最多有3个敌人出现，创建3个敌⼈的精灵组，包含属性、⾎量、射程、攻击时间间隔、刷新间隔、是否存在 移动间隔、速度、射速、攻击力
2. 包含函数：创建、移动、碰撞、⽅向计算、攻击、死亡
3. update整合里⾯包含了需要在update⾥面调⽤的所有函数，使update看起来更简洁
4. 在是否存在为0与刷新间隔为1的时候调用创建函数 每次创建都会提升敌人的速度、攻击力、射速，以增加游戏性，创建时random坐标并使⽤碰撞检测
5. 在移动间隔为1的时候调⽤移动函数，移动函数⾥面调⽤方向计算函数，计算方向时先取第一个方向为敌人与英雄最能接近的方向，之后进⾏与墙壁碰撞检测，碰撞检测为1时从剩下的3个⽅向random一个值并继续碰撞检测
6. 在攻击间隔为1的时候调用攻击函数，首先直接用⾃身坐标和英雄坐标计算出攻击的最佳方向的单位向量，之后⽤射程乘以单位向量之后调⽤子弹函数
7. 在⾎量为0时调⽤死亡函数，将攻击间隔移动间隔等所有值全调为0，并完成闪烁两下的动作，闪烁动作通过不断调⽤延迟和可见度的函数实现，闪烁之后移除父类，并给出刷新间隔

## 5.类设计



## 写在最后

#### 这是同济大学软件学院2019年C++项目的选题之一,由于种种因素没有完成联机模式以及没有及时开发出多平台可执行程序 感到遗憾.

####但还是希望大家可以支持我们的游戏,如果你有更好的建议,可以向我们提出,我们也欢迎你的加入!

####我们会在7月中旬添加开源许可,完善此项目.

#### <s>大家一定要去联机界面打赏哦</s>



